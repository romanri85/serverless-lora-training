# Output path for training runs. Each training run makes a new directory in here.
output_dir = '/training_outputs/diffusion_pipe_training_runs/z_image_base_lora'

save_every_n_epochs = 10
epochs = 80
pipeline_stages = 1
micro_batch_size_per_gpu = 1
gradient_accumulation_steps = 1
activation_checkpointing = true
dataset = 'examples/dataset.toml'
# Eval dataset for measuring loss on held-out data (smooth loss curve in TensorBoard).
# Place 5-15 captioned images in the eval_dataset_here/ folder.
eval_datasets = [
    {name = 'eval', config = 'examples/eval_dataset.toml'},
]

# eval settings
eval_every_n_epochs = 1
eval_before_first_step = true
eval_micro_batch_size_per_gpu = 1
eval_gradient_accumulation_steps = 1

[model]
type = 'z_image'
diffusion_model = '/models/z_image_base/z_image_bf16.safetensors'
vae = '/models/z_image/ae.safetensors'
text_encoders = [
    {path = '/models/z_image/qwen_3_4b.safetensors', type = 'lumina2'}
]
dtype = 'bfloat16'


[adapter]
type = "lora"
rank = 32
dtype = "bfloat16"



[optimizer]
type = 'adamw_optimi'
lr = 2e-4
betas = [0.9, 0.99]
weight_decay = 0.01
eps = 1e-8
